---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all posts and sort by publishDate (oldest first)
const allPosts = await getCollection('posts');
const sortedPosts = allPosts.sort((a, b) =>
  a.data.publishDate.getTime() - b.data.publishDate.getTime()
);
---

<BaseLayout>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">
    <!-- Post list -->
    <nav aria-label="Blog posts">
      <ul class="space-y-12 md:space-y-16" style="list-style: none; padding: 0; margin: 0;">
        {sortedPosts.map((post) => {
          // Remove file extension from id for clean URLs
          const slug = post.id.replace(/\/index\.md$/, '').replace(/\.md$/, '');
          return (
            <li>
              <a
                href={`/${slug}/`}
                class="block link-hover"
                style="color: var(--color-foreground);"
              >
                <h2 class="text-2xl md:text-3xl italic font-normal tracking-tight">
                  {post.data.title}
                </h2>
              </a>
            </li>
          );
        })}
      </ul>
    </nav>

    {sortedPosts.length === 0 && (
      <p style="color: var(--color-muted);">
        Посты пока не опубликованы.
      </p>
    )}

    <!-- Loading spinner decoration -->
    <div class="mt-16 flex justify-center" aria-hidden="true">
      <div class="w-6 h-6 rounded-full animate-spin" style="border: 2px solid var(--color-border); border-top-color: var(--color-primary);"></div>
    </div>
  </div>
</BaseLayout>
